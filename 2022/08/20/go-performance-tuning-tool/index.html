<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"weikeqin.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true,"width":240},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="医生的温度计、听诊器、血压计，可以获取就诊者的各种健康指标。   如果把研发工程师比喻成医生，那pprof就是类似温度计、听诊器、血压计的一个工具集，可以用来分析CPU、goroutine堆栈跟踪、内存分配及使用情况、互斥锁争用及耗时、goroutine阻塞 等    (1) pprof是什么  性能分析是通过分析器(profiler)工具进行检测来实现的，在 Go 中使用称为 pprof。">
<meta property="og:type" content="article">
<meta property="og:title" content="go性能分析 及 线上问题定位">
<meta property="og:url" content="http://weikeqin.com/2022/08/20/go-performance-tuning-tool/index.html">
<meta property="og:site_name" content="天道酬勤">
<meta property="og:description" content="医生的温度计、听诊器、血压计，可以获取就诊者的各种健康指标。   如果把研发工程师比喻成医生，那pprof就是类似温度计、听诊器、血压计的一个工具集，可以用来分析CPU、goroutine堆栈跟踪、内存分配及使用情况、互斥锁争用及耗时、goroutine阻塞 等    (1) pprof是什么  性能分析是通过分析器(profiler)工具进行检测来实现的，在 Go 中使用称为 pprof。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof-flamegraph2.png">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof.png">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof-graph.svg">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof-view.png">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof-graph.svg">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof-flamegraph.png">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof-flamegraph2.png">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go-pprof-top.png">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go_pprof_heap_detail.png">
<meta property="og:image" content="http://weikeqin.com/img/go/pprof/go_pprof_heap_view.png">
<meta property="article:published_time" content="2022-08-20T14:30:00.000Z">
<meta property="article:modified_time" content="2023-04-09T12:05:17.405Z">
<meta property="article:author" content="WKQ">
<meta property="article:tag" content="go">
<meta property="article:tag" content="profiler">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://weikeqin.com/img/go/pprof/go-pprof-flamegraph2.png">

<link rel="canonical" href="http://weikeqin.com/2022/08/20/go-performance-tuning-tool/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>go性能分析 及 线上问题定位 | 天道酬勤</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-113485469-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-113485469-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d1ad0ae2a9976c44d556abc07cda1365";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">天道酬勤</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">让好事发生</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://weikeqin.com/2022/08/20/go-performance-tuning-tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="WKQ">
      <meta itemprop="description" content="不积跬步无以至千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天道酬勤">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          go性能分析 及 线上问题定位
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-08-20 22:30:00" itemprop="dateCreated datePublished" datetime="2022-08-20T22:30:00+08:00">2022-08-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-09 20:05:17" itemprop="dateModified" datetime="2023-04-09T20:05:17+08:00">2023-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          
            <span id="/2022/08/20/go-performance-tuning-tool/" class="post-meta-item leancloud_visitors" data-flag-title="go性能分析 及 线上问题定位" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/08/20/go-performance-tuning-tool/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/08/20/go-performance-tuning-tool/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>  医生的<code>温度计</code>、<code>听诊器</code>、<code>血压计</code>，可以获取<code>就诊者</code>的各种健康指标。</p>
<p>  如果把<code>研发工程师</code>比喻成<code>医生</code>，那<code>pprof</code>就是类似<code>温度计</code>、<code>听诊器</code>、<code>血压计</code>的一个工具集，可以用来分析<code>CPU</code>、<code>goroutine堆栈跟踪</code>、<code>内存分配及使用情况</code>、<code>互斥锁争用及耗时</code>、<code>goroutine阻塞</code> 等</p>
<p>  <img data-src="/img/go/pprof/go-pprof-flamegraph2.png" alt="火焰图"></p>
<h1 id="1-pprof是什么"><a href="#1-pprof是什么" class="headerlink" title="(1) pprof是什么"></a>(1) pprof是什么</h1><p>  性能分析是通过<code>分析器</code>(profiler)工具进行检测来实现的，在 Go 中使用称为 pprof。</p>
<p>  pprof工具可以用来监测进程的运行数据，用于监控程序的性能及状况，以下指标都可以监控</p>
<blockquote>
<p>CPU— 确定应用程序的时间花在了哪里<br>Goroutine— 报告正在运行的 goroutines 堆栈跟踪<br>Heap— 报告堆内存分配以监视当前内存使用情况并检查可能的内存泄漏<br>Mutex— 报告锁争情况来分析代码中互斥锁使用行为以及应用程序是否在锁定调用上花费了太多时间<br>Block— 显示 goroutines 阻塞等待同步原语的位置</p>
</blockquote>
<p>  <img data-src="/img/go/pprof/go-pprof.png"></p>
<h1 id="2-如何使用pprof"><a href="#2-如何使用pprof" class="headerlink" title="(2) 如何使用pprof"></a>(2) 如何使用pprof</h1><p>  pprof必须在代码里引入才能使用<br>  不像Java里的 <code>jps</code>、<code>jstat</code>、<code>jinfo</code>、<code>jstack</code>、<code>jmap</code> 工具可以单独使用</p>
<p>  pprof 可以从以下两个包中引入</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token string">"net/http/pprof"</span>

<span class="token keyword">import</span> <span class="token string">"runtime/pprof"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>  其中 <code>net/http/pprof</code> 使用 <code>runtime/pprof</code> 包来进行封装，并在 http 端口上暴露出来。<br>  <code>runtime/pprof</code> 可以用来产生 dump 文件，再使用 go tool pprof 来分析这运行日志。</p>
<p>  使用 net/http/pprof 可以做到直接看到当前 web 服务的状态，包括 CPU 占用情况和内存使用情况等。</p>
<h2 id="2-1-通过网页可视化使用pprof"><a href="#2-1-通过网页可视化使用pprof" class="headerlink" title="(2.1) 通过网页可视化使用pprof"></a>(2.1) 通过网页可视化使用pprof</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"net/http"</span>
	<span class="token comment">// 代码里引入 pprof</span>
	<span class="token boolean">_</span> <span class="token string">"net/http/pprof"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 代码里引入http server </span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":6060"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
			log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

   <span class="token comment">// 省略业务代码</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  导入 <code>net/http/pprof</code> 的作用是，我们可以通过 <code>http://127.0.0.1:6060/debug/pprof/</code>  来访问 pprof<br>  通过 这个地址 可以通过网页很方便的查看各项指标</p>
<p>  即使在生产环境中启用 <code>pprof</code> 也是安全的</p>
<table>
<thead>
<tr>
<th align="left">作用</th>
<th align="left">关键字</th>
<th align="left">访问url</th>
</tr>
</thead>
<tbody><tr>
<td align="left">所有过去内存分配的样本</td>
<td align="left">allocs</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/allocs?debug=1</code></td>
</tr>
<tr>
<td align="left">导致同步基元阻塞的堆栈跟踪</td>
<td align="left">block</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/block?debug=1</code></td>
</tr>
<tr>
<td align="left">当前程序的命令行调用</td>
<td align="left">cmdline</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">所有当前 goroutines 的堆栈跟踪</td>
<td align="left">goroutine</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/goroutine?debug=1</code></td>
</tr>
<tr>
<td align="left">活动对象的内存分配示例</td>
<td align="left">heap</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/heap?debug=1</code></td>
</tr>
<tr>
<td align="left">争用互斥锁持有者的堆栈跟踪</td>
<td align="left">mutx</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/mutex?debug=1</code></td>
</tr>
<tr>
<td align="left">CPU性能分析</td>
<td align="left">profile</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/profile?debug=1</code></td>
</tr>
<tr>
<td align="left">创建新操作系统线程的堆栈跟踪</td>
<td align="left">threadcreate</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/threadcreate?debug=1</code></td>
</tr>
<tr>
<td align="left">当前程序执行的跟踪</td>
<td align="left">full goroutine stack dump</td>
<td align="left"><code>http://127.0.0.1:6060/debug/pprof/goroutine?debug=2</code></td>
</tr>
</tbody></table>
<h2 id="2-2-通过下载的pprof文件分析"><a href="#2-2-通过下载的pprof文件分析" class="headerlink" title="(2.2) 通过下载的pprof文件分析"></a>(2.2) 通过下载的pprof文件分析</h2><h3 id="2-2-1-下载并使用"><a href="#2-2-1-下载并使用" class="headerlink" title="(2.2.1) 下载并使用"></a>(2.2.1) 下载并使用</h3><p>  直接运行 <code>go tool pprof http://localhost:6060/debug/pprof/profile</code>，其会自动下载数据到本地，然后供分析。<br>  默认会下载到当前用户的 <code>~/pprof/pprof.samples.cpu.001.pb.gz</code> 目录下</p>
<p>  <code>go tool pprof http://localhost:6060/debug/pprof/profile</code> = <code>download filepath </code> + <code>go tool pprof filepath</code></p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>bogon thrift<span class="token operator">-</span>tutorial<span class="token operator">-</span>go<span class="token operator">-</span>demo <span class="token operator">(</span>master<span class="token operator">)</span><span class="token punctuation">]</span><span class="token operator">$</span> go tool pprof <span class="token url">http://localhost:6060/debug/pprof/profile</span> 
Fetching profile over HTTP from <span class="token url">http://localhost:6060/debug/pprof/profile</span>
Saved profile in <span class="token file-path string">/Users/weikeqin/pprof/pprof.samples.cpu.001.pb.gz</span>
<span class="token property">Type:</span> cpu
<span class="token property">Time:</span> <span class="token date number">Aug 20</span><span class="token punctuation">,</span> <span class="token number">2022</span> at <span class="token number">8</span><span class="token operator">:</span><span class="token number">37pm</span> <span class="token operator">(</span>CST<span class="token operator">)</span>
<span class="token property">Duration:</span> <span class="token number">30s</span><span class="token punctuation">,</span> Total samples <span class="token operator">=</span> <span class="token number">2.37s</span> <span class="token operator">(</span> <span class="token number">7.90</span><span class="token operator">%</span><span class="token operator">)</span>
Entering interactive mode <span class="token operator">(</span>type <span class="token string">"help"</span> for commands<span class="token punctuation">,</span> <span class="token string">"o"</span> for options<span class="token operator">)</span>
<span class="token operator">(</span>pprof<span class="token operator">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="2-2-2-下载数据离线分析"><a href="#2-2-2-下载数据离线分析" class="headerlink" title="(2.2.2) 下载数据离线分析"></a>(2.2.2) 下载数据离线分析</h3><p><strong>下载文件</strong></p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>computer <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> curl <span class="token operator">-</span>o <span class="token file-path string">/Users/weikeqin/pprof/go_profile.out</span>  <span class="token url">http://localhost:6060/debug/pprof/profile</span>
  <span class="token operator">%</span> Total    <span class="token operator">%</span> Received <span class="token operator">%</span> Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span>   <span class="token number">107</span>  <span class="token number">100</span>   <span class="token number">107</span>    <span class="token number">0</span>     <span class="token number">0</span>      <span class="token number">3</span>      <span class="token number">0</span>  <span class="token time number">0:00:35</span>  <span class="token time number">0:00:30</span>  <span class="token time number">0:00:05</span>    <span class="token number">22</span>
<span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>computer <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  执行 <code>curl -o /Users/weikeqin/pprof/go_profile.out  http://localhost:6060/debug/pprof/profile</code> ，会下载原始数据文件到 <code>/Users/weikeqin/pprof/go_profile.out</code> 目录。</p>
<p><strong>分析文件</strong></p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>computer pprof<span class="token punctuation">]</span><span class="token operator">$</span> go tool pprof <span class="token file-path string">/Users/weikeqin/pprof/go_profile.out</span>
<span class="token property">Type:</span> cpu
<span class="token property">Time:</span> <span class="token date number">Aug 20</span><span class="token punctuation">,</span> <span class="token number">2022</span> at <span class="token number">3</span><span class="token operator">:</span><span class="token number">39pm</span> <span class="token operator">(</span>CST<span class="token operator">)</span>
<span class="token property">Duration:</span> <span class="token number">30.01s</span><span class="token punctuation">,</span> Total samples <span class="token operator">=</span> <span class="token number">0</span>
No samples were found with the default sample value type<span class="token punctuation">.</span>
Try <span class="token string">"sample_index"</span> command to analyze different sample values<span class="token punctuation">.</span>
Entering interactive mode <span class="token operator">(</span>type <span class="token string">"help"</span> for commands<span class="token punctuation">,</span> <span class="token string">"o"</span> for options<span class="token operator">)</span>
<span class="token operator">(</span>pprof<span class="token operator">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<br>



<h1 id="3-分析CPU占用情况"><a href="#3-分析CPU占用情况" class="headerlink" title="(3) 分析CPU占用情况"></a>(3) 分析CPU占用情况</h1><p>  通过 <code>http://127.0.0.1:6060/debug/pprof/profile?debug=1</code> 可以下载 <code>go_pprof_profile.out</code> 文件 </p>
<h2 id="3-1-CPU分析原理"><a href="#3-1-CPU分析原理" class="headerlink" title="(3.1) CPU分析原理"></a>(3.1) CPU分析原理</h2><p>  CPU 分析器依赖于操作系统和信号。</p>
<p>  当它被激活时，应用程序默认通过 SIGPROF 信号要求操作系统每 10 毫秒中断一次。当应用程序收到 SIGPROF 时，它会暂停当前活动并将执行转移到分析器。</p>
<p>  分析器收集诸如当前 goroutine 活动之类的数据，并汇总可以检索的执行统计信息；然后停止分析并继续执行直到下一次的 SIGPROF。</p>
<p>  我们可以访问 /debug/pprof/profile 路由来激活 CPU 分析。默认情况下，访问此路由会执行 30 秒的 CPU 分析。在 30 秒内，我们的应用程序每 10 毫秒中断一次。</p>
<p>  请注意，可以更改这两个默认值：使用 seconds 参数将分析应该持续多长时间传递给路由（例如 /debug/pprof/profile?seconds=15），也可以更改中断率（甚至小于 10 毫秒）。</p>
<p>  但多数情况下，10 毫秒应该足够了，在减小这个值（意味着增加频率）时，我们应该注意不要对性能产生影响。30 秒后，就可以下载 CPU 分析器的结果。</p>
<p>  注意：<br>  也可以通过  -cpuprofile 标志来开启 CPU 分析器，比如在运行基准测试时就可以用这种方式。</p>
<p>  例如，执行以下命令后可通过 /debug/pprof/profile 下载到相同的分析结果文件。</p>
<h2 id="3-2-通过命令分析CPU数值指标"><a href="#3-2-通过命令分析CPU数值指标" class="headerlink" title="(3.2) 通过命令分析CPU数值指标"></a>(3.2) 通过命令分析CPU数值指标</h2><p>  如果在代码里使用了 <code>http.ListenAndServe(&quot;:6060&quot;, nil)</code>，可以直接访问 <code>http://127.0.0.1:6060/debug/pprof/profile?debug=1</code> 获取profile文件 </p>
<p>  获取profile文件后使用 <code>go tool pprof go_profile.out</code> 来分析CPU占用情况</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token operator">(</span>pprof<span class="token operator">)</span> 
<span class="token operator">(</span>pprof<span class="token operator">)</span> help 
  <span class="token property">Commands:</span>
    callgrind        Outputs a graph in callgrind format
    comments         Output all profile comments
    disasm           Output assembly listings annotated with samples
    dot              Outputs a graph in DOT format
    eog              Visualize graph through eog
    evince           Visualize graph through evince
    gif              Outputs a graph image in GIF format
    gv               Visualize graph through gv
    kcachegrind      Visualize report in KCachegrind
    list             Output annotated source for functions matching regexp
    pdf              Outputs a graph in PDF format
    peek             Output callers<span class="token operator">/</span>callees of functions matching regexp
    png              Outputs a graph image in PNG format
    proto            Outputs the profile in compressed protobuf format
    ps               Outputs a graph in PS format
    raw              Outputs a text representation of the raw profile
    svg              Outputs a graph in SVG format
    tags             Outputs all tags in the profile
    text             Outputs top entries in text form
    top              Outputs top entries in text form
    topproto         Outputs top entries in compressed protobuf format
    traces           Outputs all profile samples in text form
    tree             Outputs a text rendering of call graph
    web              Visualize graph through web browser
    weblist          Display annotated source in a web browser
    o<span class="token operator">/</span>options        List options and their current values
    q<span class="token operator">/</span>quit<span class="token operator">/</span>exit<span class="token operator">/</span><span class="token operator">^</span>D   Exit pprof

  <span class="token property">Options:</span>
    call_tree        Create a context<span class="token operator">-</span>sensitive call tree
    compact_labels   Show minimal headers
    divide_by        Ratio to divide all samples before visualization
    drop_negative    Ignore negative differences
    edgefraction     Hide edges below <span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token operator">*</span>total
    focus            Restricts to samples going through a node matching regexp
    hide             Skips nodes matching regexp
    ignore           Skips paths going through any nodes matching regexp
    intel_syntax     Show assembly in Intel syntax
    mean             Average sample value over first value <span class="token operator">(</span>count<span class="token operator">)</span>
    nodecount        Max number of nodes to show
    nodefraction     Hide nodes below <span class="token operator">&lt;</span>f<span class="token operator">></span><span class="token operator">*</span>total
    noinlines        Ignore inlines<span class="token punctuation">.</span>
    normalize        Scales profile based on the base profile<span class="token punctuation">.</span>
    output           Output filename for file<span class="token operator">-</span>based outputs
    prune_from       Drops any functions below the matched frame<span class="token punctuation">.</span>
    relative_percentages Show percentages relative to focused subgraph
    sample_index     Sample value to report <span class="token operator">(</span><span class="token number">0</span><span class="token operator">-</span>based index or name<span class="token operator">)</span>
    show             Only show nodes matching regexp
    show_from        Drops functions above the highest matched frame<span class="token punctuation">.</span>
    source_path      Search path for source files
    tagfocus         Restricts to samples with tags in range or matched by regexp
    taghide          Skip tags matching this regexp
    tagignore        Discard samples with tags in range or matched by regexp
    tagleaf          Adds pseudo stack frames for labels key<span class="token operator">/</span>value pairs at the callstack leaf<span class="token punctuation">.</span>
    tagroot          Adds pseudo stack frames for labels key<span class="token operator">/</span>value pairs at the callstack root<span class="token punctuation">.</span>
    tagshow          Only consider tags matching this regexp
    trim             Honor nodefraction<span class="token operator">/</span>edgefraction<span class="token operator">/</span>nodecount defaults
    trim_path        Path to trim from source paths before search
    unit             Measurement units to display

  <span class="token property">Option groups (only set one per group):</span>
    granularity      
      functions        Aggregate at the function level<span class="token punctuation">.</span>
      filefunctions    Aggregate at the function level<span class="token punctuation">.</span>
      files            Aggregate at the file level<span class="token punctuation">.</span>
      lines            Aggregate at the source code line level<span class="token punctuation">.</span>
      addresses        Aggregate at the address level<span class="token punctuation">.</span>
    sort             
      cum              Sort entries based on cumulative weight
      flat             Sort entries based on own weight
  <span class="token operator">:</span>   Clear focus<span class="token operator">/</span>ignore<span class="token operator">/</span>hide<span class="token operator">/</span>tagfocus<span class="token operator">/</span>tagignore

  type <span class="token string">"help &lt;cmd|option>"</span> for more information
<span class="token operator">(</span>pprof<span class="token operator">)</span> 
<span class="token operator">(</span>pprof<span class="token operator">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="3-2-1-生成调用关系图"><a href="#3-2-1-生成调用关系图" class="headerlink" title="(3.2.1) 生成调用关系图"></a>(3.2.1) 生成调用关系图</h3><pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token operator">(</span>pprof<span class="token operator">)</span>  web
<span class="token operator">(</span>pprof<span class="token operator">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>  会生成一个svg图片保存到 <code>file:///private/var/folders/ry/j30lp1sn19q7rbtq6020f6880000gn/T/pprof001.svg</code>，并且自动打开。</p>
<p>  <img data-src="/img/go/pprof/go-pprof-graph.svg" alt="调用关系图"></p>
<p>  每个方框代表一个函数，方框的大小和执行时间成正比，箭头代表调用关系，箭头上的时间代表被调用函数的执行时间</p>
<h3 id="3-2-2-查看top占用"><a href="#3-2-2-查看top占用" class="headerlink" title="(3.2.2) 查看top占用"></a>(3.2.2) 查看top占用</h3><pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token operator">(</span>pprof<span class="token operator">)</span> top
Showing nodes accounting for <span class="token number">5.75s</span><span class="token punctuation">,</span> <span class="token number">94.73</span><span class="token operator">%</span> of <span class="token number">6.07s</span> total
Dropped <span class="token number">118</span> nodes <span class="token operator">(</span>cum <span class="token operator">&lt;</span><span class="token operator">=</span> <span class="token number">0.03s</span><span class="token operator">)</span>
Showing top <span class="token number">10</span> nodes out of <span class="token number">94</span>
      flat  flat<span class="token operator">%</span>   sum<span class="token operator">%</span>        cum   cum<span class="token operator">%</span>
     <span class="token number">3.46s</span> <span class="token number">57.00</span><span class="token operator">%</span> <span class="token number">57.00</span><span class="token operator">%</span>      <span class="token number">3.47s</span> <span class="token number">57.17</span><span class="token operator">%</span>  <span class="token domain constant">syscall.syscall6</span>
     <span class="token number">1.34s</span> <span class="token number">22.08</span><span class="token operator">%</span> <span class="token number">79.08</span><span class="token operator">%</span>      <span class="token number">1.34s</span> <span class="token number">22.08</span><span class="token operator">%</span>  <span class="token domain constant">runtime.kevent</span>
     <span class="token number">0.30s</span>  <span class="token number">4.94</span><span class="token operator">%</span> <span class="token number">84.02</span><span class="token operator">%</span>      <span class="token number">0.30s</span>  <span class="token number">4.94</span><span class="token operator">%</span>  <span class="token domain constant">syscall.syscall</span>
     <span class="token number">0.16s</span>  <span class="token number">2.64</span><span class="token operator">%</span> <span class="token number">86.66</span><span class="token operator">%</span>      <span class="token number">0.16s</span>  <span class="token number">2.64</span><span class="token operator">%</span>  runtime<span class="token punctuation">.</span>siftdownTimer
     <span class="token number">0.12s</span>  <span class="token number">1.98</span><span class="token operator">%</span> <span class="token number">88.63</span><span class="token operator">%</span>      <span class="token number">0.13s</span>  <span class="token number">2.14</span><span class="token operator">%</span>  <span class="token domain constant">runtime.chansend</span>
     <span class="token number">0.12s</span>  <span class="token number">1.98</span><span class="token operator">%</span> <span class="token number">90.61</span><span class="token operator">%</span>      <span class="token number">0.14s</span>  <span class="token number">2.31</span><span class="token operator">%</span>  <span class="token domain constant">runtime.walltime</span>
     <span class="token number">0.10s</span>  <span class="token number">1.65</span><span class="token operator">%</span> <span class="token number">92.26</span><span class="token operator">%</span>      <span class="token number">0.10s</span>  <span class="token number">1.65</span><span class="token operator">%</span>  <span class="token domain constant">runtime.madvise</span>
     <span class="token number">0.08s</span>  <span class="token number">1.32</span><span class="token operator">%</span> <span class="token number">93.57</span><span class="token operator">%</span>      <span class="token number">0.08s</span>  <span class="token number">1.32</span><span class="token operator">%</span>  runtime<span class="token punctuation">.</span>memclrNoHeapPointers
     <span class="token number">0.06s</span>  <span class="token number">0.99</span><span class="token operator">%</span> <span class="token number">94.56</span><span class="token operator">%</span>      <span class="token number">0.06s</span>  <span class="token number">0.99</span><span class="token operator">%</span>  <span class="token domain constant">runtime.nanotime1</span>
     <span class="token number">0.01s</span>  <span class="token number">0.16</span><span class="token operator">%</span> <span class="token number">94.73</span><span class="token operator">%</span>      <span class="token number">0.16s</span>  <span class="token number">2.64</span><span class="token operator">%</span>  <span class="token domain constant">runtime.mallocgc</span>
<span class="token operator">(</span>pprof<span class="token operator">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="3-3-CPU参数页面可视化分析"><a href="#3-3-CPU参数页面可视化分析" class="headerlink" title="(3.3) CPU参数页面可视化分析"></a>(3.3) CPU参数页面可视化分析</h2><p>  如果通过 <code>go tool pprof go_profile.out</code> 分析时觉得数字不直观时，可以通过页面可视化来查看</p>
<p>  其实就是开了一个http服务，然后把 <code>go_profile.out</code> 做成可视化的了</p>
<p>  比如 go_profile.out 对应的路径是 <code>/Users/weikeqin/WorkSpaces/golang/go_profile.out</code></p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>computer <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> go tool pprof <span class="token operator">-</span>http<span class="token operator">=</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token file-path string">/Users/weikeqin/WorkSpaces/golang/go_profile.out</span> 
Serving web UI on <span class="token url">http://localhost:8080</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>  <img data-src="/img/go/pprof/go-pprof-view.png"></p>
<h3 id="3-3-1-调用链路-graph"><a href="#3-3-1-调用链路-graph" class="headerlink" title="(3.3.1) 调用链路(graph)"></a>(3.3.1) 调用链路(graph)</h3><p>  <img data-src="/img/go/pprof/go-pprof-graph.svg"></p>
<h3 id="3-3-2-火焰图-flamegraph"><a href="#3-3-2-火焰图-flamegraph" class="headerlink" title="(3.3.2) 火焰图(flamegraph)"></a>(3.3.2) 火焰图(flamegraph)</h3><p>  <img data-src="/img/go/pprof/go-pprof-flamegraph.png"></p>
<p>  <img data-src="/img/go/pprof/go-pprof-flamegraph2.png"></p>
<h3 id="3-3-3-top"><a href="#3-3-3-top" class="headerlink" title="(3.3.3) top"></a>(3.3.3) top</h3><p>  CPU top占用情况</p>
<p>  <img data-src="/img/go/pprof/go-pprof-top.png"></p>
<h2 id="3-4-分析后的收获"><a href="#3-4-分析后的收获" class="headerlink" title="(3.4) 分析后的收获"></a>(3.4) 分析后的收获</h2><p>  对 runtime.mallogc 的调用过多，意味着我们可以尝试减少过多的小堆分配<br>  在通道操作或互斥锁上花费太多时间，可能表明过度竞争正在损害应用程序的性能<br>  在 syscall.Read 或 syscall.Write 上花费太多时间，意味着应用程序在内核模式下花费了大量时间。处理 I/O 缓冲可能是改进的途径</p>
<br>

 

<h1 id="4-分析内存-堆占用情况"><a href="#4-分析内存-堆占用情况" class="headerlink" title="(4) 分析内存-堆占用情况"></a>(4) 分析内存-堆占用情况</h1><p>  通过 <code>http://127.0.0.1:6060/debug/pprof/heap?debug=1</code> 可以查看堆占用情况 </p>
<h2 id="4-1-堆分析原理"><a href="#4-1-堆分析原理" class="headerlink" title="(4.1) 堆分析原理"></a>(4.1) 堆分析原理</h2><p>  与 CPU 分析一样，堆分析也是基于采样的。</p>
<h2 id="4-2-分析堆占用数字指标"><a href="#4-2-分析堆占用数字指标" class="headerlink" title="(4.2) 分析堆占用数字指标"></a>(4.2) 分析堆占用数字指标</h2><p>  通过 <code>http://127.0.0.1:6060/debug/pprof/heap?debug=1</code> 可以获取堆占用的详细数字指标</p>
<p>  <img data-src="/img/go/pprof/go_pprof_heap_detail.png"></p>
<h2 id="4-3-通过工具分析"><a href="#4-3-通过工具分析" class="headerlink" title="(4.3) 通过工具分析"></a>(4.3) 通过工具分析</h2><pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>computer pprof<span class="token punctuation">]</span><span class="token operator">$</span> go tool pprof <span class="token file-path string">/Users/weikeqin/pprof/go_pprof_heap.out</span>
<span class="token property">Type:</span> inuse_space
<span class="token property">Time:</span> <span class="token date number">Aug 20</span><span class="token punctuation">,</span> <span class="token number">2022</span> at <span class="token number">4</span><span class="token operator">:</span><span class="token number">29pm</span> <span class="token operator">(</span>CST<span class="token operator">)</span>
Entering interactive mode <span class="token operator">(</span>type <span class="token string">"help"</span> for commands<span class="token punctuation">,</span> <span class="token string">"o"</span> for options<span class="token operator">)</span>
<span class="token operator">(</span>pprof<span class="token operator">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token operator">(</span>pprof<span class="token operator">)</span>  svg
Generating report in <span class="token domain constant">profile001.svg</span>
<span class="token operator">(</span>pprof<span class="token operator">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>  生成svg，查看堆占用情况</p>
<h2 id="4-3-通过网页可视化分析"><a href="#4-3-通过网页可视化分析" class="headerlink" title="(4.3) 通过网页可视化分析"></a>(4.3) 通过网页可视化分析</h2><p>  通过 <code>http://127.0.0.1:6060/debug/pprof/heap?debug=0</code> 下载文件，下载的文件可以重名名</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>bogon <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> go tool pprof <span class="token operator">-</span>http<span class="token operator">=</span><span class="token operator">:</span><span class="token number">8082</span> <span class="token file-path string">/Users/weikeqin/pprof/go_pprof_heap.out</span>
Serving web UI on <span class="token url">http://localhost:8082</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>  <img data-src="/img/go/pprof/go_pprof_heap_view.png"></p>
<p>alloc_objects— 分配的对象总数<br>alloc_space— 分配的内存总量<br>inuse_objects— 已分配但尚未释放的对象数<br>inuse_space— 已分配但尚未释放的内存量</p>
<h1 id="5-遇到的问题"><a href="#5-遇到的问题" class="headerlink" title="(5) 遇到的问题"></a>(5) 遇到的问题</h1><h2 id="5-1-Could-not-execute-dot-may-need-to-install-graphviz"><a href="#5-1-Could-not-execute-dot-may-need-to-install-graphviz" class="headerlink" title="(5.1) Could not execute dot; may need to install graphviz."></a>(5.1) Could not execute dot; may need to install graphviz.</h2><pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>weikeqin<span class="token operator">@</span>bogon thrift<span class="token operator">-</span>tutorial<span class="token operator">-</span>go<span class="token operator">-</span>demo <span class="token operator">(</span>master<span class="token operator">)</span><span class="token punctuation">]</span><span class="token operator">$</span> go tool pprof <span class="token operator">-</span>http<span class="token operator">=</span><span class="token operator">:</span><span class="token number">8080</span> <span class="token file-path string">/Users/weikeqin/WorkSpaces/golang/go_profile.out</span> 
Serving web UI on <span class="token url">http://localhost:8080</span>
Failed to execute dot<span class="token punctuation">.</span> Is Graphviz installed<span class="token operator">?</span>
<span class="token property">exec:</span> <span class="token string">"dot"</span><span class="token operator">:</span> executable file not found in <span class="token operator">$</span>PATH
Failed to execute dot<span class="token punctuation">.</span> Is Graphviz installed<span class="token operator">?</span>
<span class="token property">exec:</span> <span class="token string">"dot"</span><span class="token operator">:</span> executable file not found in <span class="token operator">$</span>PATH
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>  到 <a target="_blank" rel="noopener" href="https://www.graphviz.org/download/">https://www.graphviz.org/download/</a> 下载 Graphviz </p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>[1] <a target="_blank" rel="noopener" href="https://juejin.cn/post/7002963307787190309">如何排查 Go 程序 CPU 占用过高问题</a><br>[2] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/368567370">Go 程序内存泄露问题快速定位</a><br>[3] <a target="_blank" rel="noopener" href="https://blog.wolfogre.com/posts/go-ppof-practice/">golang pprof 实战</a>  △<br>[4] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/396363069">实用go pprof使用指南</a><br>[5] <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/7_b1NnoLxyE-kp7mnfXj4w">Go 中的性能分析和执行跟踪</a>  ☆<br>[6] <a target="_blank" rel="noopener" href="https://go.dev/doc/diagnostics#profiling">go.dev-doc-diagnostics#profiling</a><br>[7] <a target="_blank" rel="noopener" href="https://www.cnblogs.com/TimLiuDream/p/10038239.html">使用google的pprof工具以及在gin中集成pprof</a><br>[8] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/51559344">Golang性能测试工具PProf应用详解</a><br>[9] <a target="_blank" rel="noopener" href="https://medium.com/@teivah/concurrency-isnt-always-faster-in-go-de325168907c">Concurrency isn’t Always Faster in Go</a></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/11/06/go-design-philosophy/" rel="bookmark">go语言设计哲学</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/11/14/go-generic/" rel="bookmark">go语言泛型</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/11/14/go-interface/" rel="bookmark">Go语言的接口类型</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/11/20/go-mutex/" rel="bookmark">go语言 互斥锁 sync.Mutex</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/2021/10/24/go-map/" rel="bookmark">go语言map笔记</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/img/pay/wechatpay.png" alt="WKQ 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/img/pay/alipay.png" alt="WKQ 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/go/" rel="tag"># go</a>
              <a href="/tags/profiler/" rel="tag"># profiler</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/07/30/rocksdb-index-model/" rel="prev" title="RocksDB索引模型">
      <i class="fa fa-chevron-left"></i> RocksDB索引模型
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/09/04/linux-network-packet-receiving-process/" rel="next" title="Linux网络包接收流程">
      Linux网络包接收流程 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-pprof%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">(1) pprof是什么</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8pprof"><span class="nav-text">(2) 如何使用pprof</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E9%80%9A%E8%BF%87%E7%BD%91%E9%A1%B5%E5%8F%AF%E8%A7%86%E5%8C%96%E4%BD%BF%E7%94%A8pprof"><span class="nav-text">(2.1) 通过网页可视化使用pprof</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E9%80%9A%E8%BF%87%E4%B8%8B%E8%BD%BD%E7%9A%84pprof%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90"><span class="nav-text">(2.2) 通过下载的pprof文件分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-%E4%B8%8B%E8%BD%BD%E5%B9%B6%E4%BD%BF%E7%94%A8"><span class="nav-text">(2.2.1) 下载并使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-%E4%B8%8B%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%A6%BB%E7%BA%BF%E5%88%86%E6%9E%90"><span class="nav-text">(2.2.2) 下载数据离线分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E5%88%86%E6%9E%90CPU%E5%8D%A0%E7%94%A8%E6%83%85%E5%86%B5"><span class="nav-text">(3) 分析CPU占用情况</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-CPU%E5%88%86%E6%9E%90%E5%8E%9F%E7%90%86"><span class="nav-text">(3.1) CPU分析原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E5%88%86%E6%9E%90CPU%E6%95%B0%E5%80%BC%E6%8C%87%E6%A0%87"><span class="nav-text">(3.2) 通过命令分析CPU数值指标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-%E7%94%9F%E6%88%90%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="nav-text">(3.2.1) 生成调用关系图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-%E6%9F%A5%E7%9C%8Btop%E5%8D%A0%E7%94%A8"><span class="nav-text">(3.2.2) 查看top占用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-CPU%E5%8F%82%E6%95%B0%E9%A1%B5%E9%9D%A2%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90"><span class="nav-text">(3.3) CPU参数页面可视化分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-%E8%B0%83%E7%94%A8%E9%93%BE%E8%B7%AF-graph"><span class="nav-text">(3.3.1) 调用链路(graph)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-%E7%81%AB%E7%84%B0%E5%9B%BE-flamegraph"><span class="nav-text">(3.3.2) 火焰图(flamegraph)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-top"><span class="nav-text">(3.3.3) top</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E5%88%86%E6%9E%90%E5%90%8E%E7%9A%84%E6%94%B6%E8%8E%B7"><span class="nav-text">(3.4) 分析后的收获</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E5%88%86%E6%9E%90%E5%86%85%E5%AD%98-%E5%A0%86%E5%8D%A0%E7%94%A8%E6%83%85%E5%86%B5"><span class="nav-text">(4) 分析内存-堆占用情况</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%A0%86%E5%88%86%E6%9E%90%E5%8E%9F%E7%90%86"><span class="nav-text">(4.1) 堆分析原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E5%88%86%E6%9E%90%E5%A0%86%E5%8D%A0%E7%94%A8%E6%95%B0%E5%AD%97%E6%8C%87%E6%A0%87"><span class="nav-text">(4.2) 分析堆占用数字指标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E9%80%9A%E8%BF%87%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90"><span class="nav-text">(4.3) 通过工具分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E9%80%9A%E8%BF%87%E7%BD%91%E9%A1%B5%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%86%E6%9E%90"><span class="nav-text">(4.3) 通过网页可视化分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">(5) 遇到的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-Could-not-execute-dot-may-need-to-install-graphviz"><span class="nav-text">(5.1) Could not execute dot; may need to install graphviz.</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">WKQ</p>
  <div class="site-description" itemprop="description">不积跬步无以至千里</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">313</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">58</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:weikeqin.cn@gmail.com" title="E-Mail → mailto:weikeqin.cn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



<script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=5rcgvdncuwu&amp;m=7&amp;c=e63100&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=90&amp;lx=-420&amp;ly=420&amp;hi=20&amp;he=7&amp;hc=a8ddff&amp;rs=80" async="async"></script>


      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WKQ</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'Ca876j76FoCQi1SShjT0qC6k-gzGzoHsz',
      appKey     : 'IeozLmM20GuvfcslfWgdNXP0',
      placeholder: "期待您的评论",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
